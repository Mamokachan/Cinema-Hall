const DATABASE = [
{
movie: 'Дети шпионов',
detail: 'Оригинальное название: Spy Kids Год: 2001 Страна: США Слоган: «Real Spies... only smaller» Режиссер: Роберт Родригес Жанр: Боевики, Комедии, Приключенческие, Семейные, Фантастические Продолжительность: 01:28:31 В главных ролях: Антонио Бандерас, Карла Гуджино, Алекса ПенаВега, Дэрил Сабара, Алан Камминг, Тони Шэлуб, Тери Хэтчер, Чич Марин, Роберт Патрик, Дэнни Трехо',
plot: '<p>Два самых крутых шпиона во всем мире, Грегорио Кортес и Ингрид, получили одно и то же сверхсекретное задание – убить друг друга. И личная встреча ни чуть им не помогла: они поженились и бросили свою работу… Но через несколько лет, после исчезновение семерых агентов они вынуждены снова взяться за старое. Причиной было то, что их старые коллеги, самые лучшие профессионалы, начали исчезать друг за другом. И вновь Кортесы нужны агентству, чтобы они раскрыли секреты Пальчика, который формирует армию детей-роботов. Конечно, участь исчезновения настигает и супругов Кортесов. И теперь судьба пленников зависит только от того, смогут ли их родные дети правильно распорядиться всеми новейшими сверхсекретными шпионскими штучками из арсенала легендарных родителей…</p>',
img: 'https://avatars.mds.yandex.net/get-kinopoisk-image/1773646/7042bde8-3df2-42d3-bd23-79a02df6556c/600x900',
link: 'https://www.youtube.com/watch?v=5Q3BxlTISeo',
session: [{
		date: 15.04,
		seat: 50,
		reserved: [0, 15, 23, 34, 47],
		},
		{
		date: 16.04,
		seat: 30,
		reserved: [2, 9, 16, 27, 29],
		},
		{
		date: 17.04,
		seat: 40,
		reserved: [1, 7, 14, 20, 32],
	}]
},
{
movie: 'Артур и минипуты',
detail: 'Оригинальное название:	Arthur et les Minimoys Год выхода: 2006 Страна: Франция Жанр: Мультфильмы Продолжительность: 01:40:32 Режиссер: Люк Бессон В главных ролях: Фредди Хаймор, Миа Фэрроу, Рон Кроуфорд, Пенни Бальфур, Даг Рэнд, Адам ЛеФевр, Жан Бежот Нжамба, Сауль Джефкотт, Ли ДеЛонг, Кристиан Эриксон Слоган: «Adventure awaits in your own backyard.»',
plot: '',
img: 'https://upload.wikimedia.org/wikipedia/ru/1/1c/%D0%90%D1%80%D1%82%D1%83%D1%80_%D0%B8_%D0%BC%D0%B8%D0%BD%D0%B8%D0%BF%D1%83%D1%82%D1%8B_%28Arthur_et_les_Minimoys%29_for_Russian_Wikipedia_about_cinema.jpg',
link: 'https://www.youtube.com/watch?v=pmA4xwoMb_Y',
session: [{
	date: 16.04,
	seat: 30,
	reserved: [1, 3, 4, 6],
	}]
},

{
movie: 'Монстр в Париже',
detail: 'Оригинальное название:	Un monstre à Paris Год:	2011 Страна: Франция Режиссер: Бибо Бержерон Жанр: Мультфильмы Время: 01:30:21 В главных ролях: Ванесса Паради, Матье Шедид, Гад Эльмалех, Франсуа Клюзе, Людивин Санье, Жюли Ферье, Бруно Саломон, Себастьян Дежу, Филип Петью, Боб Бэлабан <p>События мультфильма разворачиваются в Париже в 1910 году, в то время, когда Сена вышла из берегов, и население страдает от наводнения. У одного гениального изобретателя живет в доме ученая обезьяна, на спине которой проживает обычная блоха. Однажды в оранжерею к ученому попадает самоучка-изобретатель Рауль со своим другом киномехаником Эмилем. Они устраивают там переполох, вследствие которого блоха ученой обезьяны превращается в огромное чудовище, прыгающее по городу. Этим происшествие немедленно пользуется комиссар полиции Мэйнот, который обещает горожанам спасти их от этого огромного насекомого. Комиссар влюблен в певицу кабаре Люсиль, и таким образом он рассчитывает завоевать ее благосклонность и расположение… </p>',
plot: '',
img: 'https://www.tvguide.com/a/img/catalog/provider/1/2/1-172455133.jpg',
link: 'https://www.youtube.com/watch?v=gWnpo_0JDm0 ',
session: [{
	date: 17.04,
	seat: 50,
	reserved: [1, 4, 8, 9],
	}]
},

{
movie: 'Алиса в Стране чудес',
detail: 'Оригинальное название:	Alice in Wonderland Год: 1951 Страна: США Слоган: «A world of wonders in One Great Picture» Режиссер: Клайд Джероними, Уилфред Джексон, Хэмильтон Ласки Жанр: Мультфильмы Время: 01:15:28 В главных ролях: Катрин Бомонт, Эд Винн, Ричард Хейдн, Стерлинг Холлоуэй, Джерри Колонна, Верна Фелтон, Дж. Пэт О’Мэлли, Билл Томпсон, Хэзер Эйнджел, Джозеф Кернс',
plot: '',
img: 'https://avatars.mds.yandex.net/get-kinopoisk-image/1773646/3ecb0277-fb26-4b46-8d78-a8d71bccd623/600x900',
link: 'https://www.youtube.com/watch?v=INNByQyPu80 ',
session: [{
	date: 17.04,
	seat: 30,
	reserved: [1, 4, 8, 9],
	}]
},

{
movie: 'Ла-Ла Ленд',
detail: 'Название:	Ла-Ла Ленд Оригинальное название: La La Land Год: 2016 Страна: США Режиссер: Дэмьен Шазелл Жанр: Драмы, Комедии, Мелодрамы, Мюзиклы Время: 02:08:34 В главных ролях: Райан Гослинг, Эмма Стоун, Джон Ледженд, Дж.К. Симмонс, Розмари ДеУитт, Финн Уиттрок, Калли Эрнандес, Соноя Мидзуно, Джессика Рот, Том Эверетт Скотт Слоган: «Бесстрашным мечтателям посвящается…» >< Миа — молодая девушка, проживающая в Лос-Анджелесе. Она работает официантом в одном из кафе и мечтает стать знаменитой актрисой. Девушка посещает множество кастингов, но ей пока не удалось получить долгожданную роль. Однажды она знакомится с молодым пианистом Себастьяном, который совсем недавно лишился работы. Парень мечтает открыть собственный джаз-клуб, в котором он будет исполнять любимые произведения, но пока ему приходится за гроши работать в ресторанах и барах. С первого взгляда между молодыми людьми вспыхивают чувства, которые дарят им веру в свои силы. Постепенно они начинают добиваться успеха, однако это не начинает влиять на их отношения, причем не в лучшую сторону...',
plot: '',
img: 'https://upload.wikimedia.org/wikipedia/ru/e/e4/La_La_Land.jpg',
link: 'https://www.youtube.com/watch?v=_NIv5QT-vb0 ',
session: [{
	date: 17.04,
	seat: 50,
	reserved: [1, 4, 8, 9],
	}]
},
];



function showBooked(places) {
	const seats = document.getElementsByClassName("seat");
	let arr = Array.from(seats);

	arr.forEach((current, index) => {
	for (let i = 0; i < places.length; i++) {
		if (index === places[i]) current.classList.toggle("booked");
		}
	});

};


function sessionClick(event) {
	let indexes = event.id.split("-");
	console.log(indexes);
	let session = DATABASE[indexes[0]].session[indexes[1]];
	let reserved = DATABASE[indexes[0]].session[indexes[1]].reserved;
	let sessionCount = session.seat;
	const root = document.getElementsByClassName("session-root");

	showSeat(sessionCount, root[indexes[0]]);
	showBooked(reserved);
	alertSeat(reserved);

	// let session = DATABASE[0].session[event.id];
	// let reserved = DATABASE[0].session[event.id].reserved;
	// showSeat(session);
	// showBooked(reserved);
	// alertSeat(reserved);
};


function showSeat (session, root) {
	let forArr = ``;
	for (let i = 0; i < session; i++) {
	forArr += `<div class="seat" id=${i}> </div>`;
	}
	let cinemahall = `
	<div class=".mw-session">
	<div id="cinemahall"> 
		${forArr}
		</div>
	</div>
	`;
	root.innerHTML = cinemahall;
}


function alertSeat(reserved) {
	const seats = document.getElementsByClassName("seat");
	const seatsArr = Array.from(seats);
	let show = seatsArr.forEach((eachSeat, idex) => 
		eachSeat.addEventListener('click', function clickID () { 
			const curSeatID = this.id;
			const curSeatIdInt = parseInt(curSeatID);
			console.log(reserved.includes(curSeatIdInt));
			reserved.includes(curSeatIdInt) ?
				alert(`You have clicked on the ${curSeatIdInt+1} seat and it is booked! Please, choose another one.`) : 
				alert(`You have clicked on the ${curSeatIdInt+1} seat and it is empty! Feel free to book it!`) ;
			 
		  } )
		);
}


function loader() {
	const heading = Array.from(document.getElementsByClassName("el__heading"));
	const bg = Array.from(document.getElementsByClassName("el__bg"));
	const inf = Array.from(document.getElementsByClassName("details"));
	const name = Array.from(document.getElementsByClassName("el__text"));
	const links = Array.from(document.getElementsByClassName("link"));
	let temp = '';

	for (let i = 0; i < DATABASE.length; i += 1) {

		heading[i].innerHTML = DATABASE[i].movie;
		// заголовки секций, название фильма

		temp = DATABASE[i].img;
		bg[i].style.backgroundImage = `url(${temp})`;
		bg[i].style.backgroundRepeat = "no-repeat";
		bg[i].style.backgroundPosition = "left"; 
		bg[i].style.backgroundSize = 'contain';
		bg[i].style.backgroundAttachment = 'fixed';
		// фоновые постеры для секций

		inf[i].innerHTML = DATABASE[i].detail;
		// детали фильма в каждую секцию

		name[i].innerHTML = DATABASE[i].movie;
		// название фильма (левая часть)

		links[i].innerHTML = DATABASE[i].movie;
		links[i].href = DATABASE[i].link;
		// ссылка на просмотр
	}
}

loader();


function renderSeans() {
	let seansRoot = Array.from(document.getElementsByClassName("seans"));
	let session = null;

	seansRoot.forEach(function (current, index) {
	session = DATABASE[index].session;
	let links = ``; 

	for (let i = 0; i < session.length; i++) {
		links += `<span class="el__sesion__link" id=${index+"-"+i} onclick="sessionClick(this)"> Сеанс ${session[i].date}  </span> <br>`
	};

	//let session-root = `<div class="session-root" id="1"> </div>`;
	let div = document.createElement('div');
	div.className = "session-root";
	div.id = index;

	current.innerHTML = links;
	current.append(div);

	});
};

renderSeans();