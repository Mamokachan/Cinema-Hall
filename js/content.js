const DATABASE = [
  {
    movie: 'Неприкасаемые / 1+1',
    detail: `Оригинальное название: Intouchables; Год: 2011; Страна: Франция; Продолжительность: 01:52:25; Жанр: Драмы, Комедии; Режиссер: Оливье Накаш, Эрик Толедано; В главных ролях: Франсуа Клюзе, Омар Си, Анн Ле Ни, Одри Флеро, Клотильд Молле, Альба Гайя Крагеде Беллуджи, Сирил Менди, Кристиан Амери, Грегуар Эстерманн, Жозефин де Мо.`,
    plot: '<p>В результате страшного несчастного случая Филипп, очень богатый и известный аристократ, лишился возможности ходить, и теперь навсегда прикован к инвалидному креслу. Он решает нанять себе помощника, который стал бы для него подмогой в непростых делах инвалида. Но выбор его весьма странен. Его спутником становится недавно вышедший из тюрьмы молодой человек. И он не ошибся. Не смотря на неподвижность Филиппа, парню удаётся вернуть того к жизни. Его бесшабашные авантюры и шутки оживляют аристократа и возвращают его в реальный мир.</p>',
    img: 'https://image.tmdb.org/t/p/w1280/7Yela5cfzuhNvnqqrLyhVhqXF95.jpg',
    link: 'https://www.youtube.com/embed/whTjYy464cY',
    trailer: 'https://www.youtube.com/embed/34WIbmXkewU',
    session: [
      {
        date: '14:30',
        seat: 90,
        reserved: [
          0, 4, 5, 14, 15, 23, 27, 32, 34, 44, 47, 52, 53, 62, 68, 74, 75, 83,
          86,
        ],
      },
      {
        date: '17:50',
        seat: 100,
        reserved: [2, 9, 15, 16, 17, 34, 44, 45, 59],
      },
      {
        date: '20:20',
        seat: 70,
        reserved: [4, 5, 12, 15, 16, 26, 37, 38, 42, 57, 64, 65],
      },
      {
        date: '22:40',
        seat: 70,
        reserved: [5, 6, 10, 11, 31, 45, 54, 68],
      },
      {
        date: '00:50',
        seat: 60,
        reserved: [1, 7, 14, 20, 32, 55, 56],
      },
    ],
  },

  {
    movie: 'Мой маленький пони в кино',
    detail: `Оригинальное название: My Little Pony: The Movie; Год: 2017; Страна: Канада, США; Продолжительность: 01:39:23; Жанр: Мультфильмы; Режиссер: Джейсон Тиссен; В главных ролях: Узо Адуба, Эшли Болл, Эмили Блант, Кристин Ченоуэт, Мишель Кребер, Тэй Диггз, Брайан Добсон, Майкл Добсон, Андреа Либман.`,
    plot: '<p>Жизнь в Эквистерии течет своим чередом, пока в небе не появляется таинственный дирижабль, на борту которого находится злобная пони-единорог Буря. Она является правой рукой зловещего Короля Шторма, захватившего земли к югу от Эквистерии. Не желая останавливаться на достигнутом, он решил прибрать к рукам и страну пони, лишив их магии. Буря с легкостью справилась с тремя могущественными принцессами и теперь ей осталось победить только Твайлайт Спаркл. Однако принцессе дружбы удалось сбежать вместе с верными друзьями, и теперь на их плечи ложится огромная ответственность за всю страну. Смогут ли они остановить злобного короля и спасти свой чудесный мир?..</p>',
    img: 'https://mstrok.ru/assets/mstrok_files_2/images/afisha/2017/10/11/928612.jpg',
    link: 'https://www.youtube.com/embed/tZvwQRRNFWM',
    trailer: 'https://www.youtube.com/embed/uVORfWM1_9E',
    session: [
      {
        date: '11:00',
        seat: 80,
        reserved: [0, 15, 23, 34, 47, 54, 55, 56, 62, 79],
      },
      {
        date: '14:20',
        seat: 70,
        reserved: [
          1, 7, 10, 12, 13, 14, 25, 35, 36, 39, 46, 48, 49, 54, 58, 63, 66, 68,
          69,
        ],
      },
      {
        date: '16:15',
        seat: 100,
        reserved: [
          4, 5, 11, 12, 16, 18, 20, 21, 24, 29, 35, 38, 41, 43, 44, 46, 48, 52,
          53, 55, 58, 61, 72, 74, 75, 76, 87, 88, 96, 97,
        ],
      },
      {
        date: '18:20',
        seat: 100,
        reserved: [
          0, 5, 14, 15, 16, 17, 18, 19, 25, 47, 48, 54, 54, 67, 77, 78, 94, 95,
        ],
      },
      {
        date: '20:00',
        seat: 60,
        reserved: [1, 7, 14, 15, 20, 25, 26, 32, 33, 43, 51, 58],
      },
    ],
  },

  {
    movie: 'Артур и минипуты',
    detail: `Оригинальное название: Arthur et les Minimoys; Год выхода: 2006; Страна: Франция; Продолжительность: 01:40:32; Жанр: Мультфильмы; Режиссер: Люк Бессон; В главных ролях: Фредди Хаймор, Миа Фэрроу, Рон Кроуфорд, Пенни Бальфур, Даг Рэнд, Адам ЛеФевр, Жан Бежот Нжамба, Сауль Джефкотт, Ли ДеЛонг, Кристиан Эриксон.`,
    plot: '<p>На долю десятилетнего Артура выпало непростое испытание: дом его бабушки хотят отнять за долги, и никто не поможет ему справиться с этой напастью. Быть может, ключ к решению проблемы кроется в сокровищах его дедушки, которые спрятаны где-то в стране минипутов, сказочных крохотных существ. В стране минипутов Артур знакомится с принцессой Селенией и её братом Барахлюшем. Их ждёт множество захватывающих приключений, опасностей и интриг на пути, который ведёт их в запретный город Некрополис. Там детской компании предстоит пережить недетский ужас в лице Ужасного Урдалака.</p>',
    img: 'https://kinochannel.ru/wp-content/uploads/2017/06/b5285bf9fb5587939c1ca2bf6e59618c.jpg',
    link: 'https://www.youtube.com/embed/pmA4xwoMb_Y',
    trailer: 'https://www.youtube.com/embed/A7HVzD3vdh8',
    session: [
      {
        date: '9:25',
        seat: 50,
        reserved: [6, 7, 8, 12, 16, 17, 18, 30, 32, 40, 43, 45],
      },
      {
        date: '16:10',
        seat: 70,
        reserved: [
          1, 3, 10, 12, 13, 15, 17, 20, 21, 23, 24, 25, 35, 36, 37, 39, 43, 44,
          46, 47, 49, 50, 53, 59, 64, 66, 67, 68,
        ],
      },
      {
        date: '19:00',
        seat: 80,
        reserved: [
          6, 8, 13, 15, 17, 20, 21, 22, 26, 27, 29, 31, 34, 41, 47, 48, 50, 51,
          54, 56, 60, 63, 65, 66, 69, 70, 71, 73,
        ],
      },
    ],
  },

  {
    movie: 'Клуб Винкс: Тайна морской бездны',
    detail: `Оригинальное название: Winx Club: Il Mistero degli Abissi; Год: 2014; Страна: Италия; Продолжительность: 01:22:39; Жанр: Мультфильмы; Режиссер: Иджинио Страффи; В главных ролях: Летиция Чиампа, Перла Либератори, Илария Латини, Джемма Донати, Домитилья Д’амико, Лаура Ленги, Марко Вивио, Алессандра Коромпай, Татьяна Десси, Федерика Де Бортоли.`,
    plot: '<p>Трикс вернулись! Они хотят завладеть Императорским Троном, чтобы активировать огромную силу, но случайно будят Политею — злую нимфу, до сих пор проклятую тремя Древними Ведьмами Прородительницами. Она готова заключить сделку с Трикс. Политея рассказывает им о том, что для активации Трона им нужно освободить Тританнуса из Обливиона, но до этого им нужно заполучить жизненную силу Короля. Трикс сразу подумали о Скае, который является королём Эраклиона и к тому же женихом Блум. Ведьмы отправляются в Гардению, где Блум и Скай проводят время вместе.<p>',
    img: 'http://media.filmz.ru/photos/full/filmz.ru_f_197953.jpg',
    link: 'https://www.youtube.com/embed/TPvcnrvav6c',
    trailer: 'https://www.youtube.com/embed/ET0VNK2dii8',
    session: [
      {
        date: '11:45',
        seat: 50,
        reserved: [3, 8, 9, 11, 14, 16, 19, 26, 27, 29, 32, 40, 42, 43, 48],
      },
      {
        date: '15:30',
        seat: 90,
        reserved: [
          1, 6, 7, 8, 9, 19, 21, 23, 44, 51, 58, 59, 64, 65, 77, 80, 83,
        ],
      },
    ],
  },

  {
    movie: 'Ла-Ла Ленд',
    detail: `Оригинальное название: La La Land; Год: 2016; Страна: США; Продолжительность: 02:08:34; Жанр: Драмы, Комедии, Мелодрамы, Мюзиклы; Режиссер: Дэмьен Шазелл; В главных ролях: Райан Гослинг, Эмма Стоун, Джон Ледженд, Дж.К. Симмонс, Розмари ДеУитт, Финн Уиттрок, Калли Эрнандес, Соноя Мидзуно, Джессика Рот, Том Эверетт Скотт.`,
    plot: '<p>Миа — молодая девушка, проживающая в Лос-Анджелесе. Она работает официантом в одном из кафе и мечтает стать знаменитой актрисой. Девушка посещает множество кастингов, но ей пока не удалось получить долгожданную роль. Однажды она знакомится с молодым пианистом Себастьяном, который совсем недавно лишился работы. Парень мечтает открыть собственный джаз-клуб, в котором он будет исполнять любимые произведения, но пока ему приходится за гроши работать в ресторанах и барах. С первого взгляда между молодыми людьми вспыхивают чувства, которые дарят им веру в свои силы. Постепенно они начинают добиваться успеха, однако это не начинает влиять на их отношения, причем не в лучшую сторону...</p>',
    img: 'https://www.stratege.ru/forums/files/gallery/1/5df/038/6c185c5a4b5ec98825adfcc71be8beaa.jpg',
    link: 'https://www.youtube.com/embed/_NIv5QT-vb0',
    trailer: 'https://www.youtube.com/embed/hWrRLnn6McI',
    session: [
      {
        date: '10:15',
        seat: 60,
        reserved: [0, 9, 12, 26, 27, 28, 30, 32, 33, 39, 43, 49, 54, 56],
      },
      {
        date: '18:20',
        seat: 70,
        reserved: [
          1, 2, 8, 9, 10, 14, 15, 20, 21, 25, 26, 29, 30, 36, 38, 43, 44, 45,
          57, 60, 66, 69,
        ],
      },
      {
        date: '22:10',
        seat: 50,
        reserved: [
          1, 7, 8, 10, 11, 14, 15, 16, 17, 22, 23, 26, 36, 37, 39, 44, 48,
        ],
      },
    ],
  },
];

// секции и их заполнение

function loader() {
  const heading = Array.from(document.getElementsByClassName('el__heading'));
  const bg = Array.from(document.getElementsByClassName('el__bg'));
  const inf = Array.from(document.getElementsByClassName('el__details'));
  const plots = Array.from(document.getElementsByClassName('el__plots'));
  const name = Array.from(document.getElementsByClassName('el__text'));
  const treilers = Array.from(document.getElementsByClassName('el__player'));
  let tempImg = '';
  let tempDet = '';

  for (let i = 0; i < DATABASE.length; i += 1) {
    heading[i].innerHTML = `⚝ ${DATABASE[i].movie} ⚝`;
    // заголовки секций, название фильма

    tempImg = DATABASE[i].img;
    bg[i].style.backgroundImage = `url(${tempImg})`;
    bg[i].style.backgroundRepeat = 'no-repeat';
    bg[i].style.backgroundPosition = 'left';
    bg[i].style.backgroundSize = 'contain';
    bg[i].style.backgroundAttachment = 'fixed';
    // фоновые постеры для секций

    const par = DATABASE[i].detail.split(';');
    tempDet = '';
    for (let j = 0; j < par.length; j += 1) {
      tempDet += `<p>${par[j]}</p> `;
    }
    // заполнение деталей фильма по секциям + перенос

    inf[i].innerHTML = tempDet;
    plots[i].innerHTML = DATABASE[i].plot;
    // добавление краткого описания

    name[i].innerHTML = DATABASE[i].movie;
    // название фильма (левая часть)

    treilers[i].src = DATABASE[i].trailer;
    // проигрыватель для трейлера
  }
}

loader();

// работа с сеансами

function renderSeans() {
  const seansRoot = Array.from(document.getElementsByClassName('el__seans'));
  let session = null;

  seansRoot.forEach((current, index) => {
    session = DATABASE[index].session;
    let links = ``;

    for (let i = 0; i < session.length; i += 1) {
      links += `<span class="el__sesion__link" id=${`${index}-${i}`} onclick="sessionClick(this)"> Сеанс ${
        session[i].date
      }  </span> <br>`;
    }

    const div = document.createElement('div');
    div.className = 'session-root';
    div.id = index;

    current.innerHTML = links;
    current.append(div);
  });
}

renderSeans();

function showSeat(session, rootRender) {
  let forArr = ``;
  for (let i = 0; i < session; i += 1) {
    forArr += `<div class="seat" id=${i}> </div>`;
  }
  const cinemahall = `
	<div class="mw-session">
		<div id="tickets">Вы ещё не выбрали место</div>
	<div id="cinemahall">
		${forArr}
		</div>
	</div>
	`;
  rootRender.innerHTML = cinemahall;
}

function showBooked(places) {
  const seats = document.getElementsByClassName('seat');
  const { reserved } = places;
  const arrSeat = Array.from(seats);

  arrSeat.forEach((current, index) => {
    for (let i = 0; i < reserved.length; i += 1) {
      if (index === reserved[i]) current.classList.toggle('booked');
    }
  });
}

// нажатие на сиденье, запись места, передача даных на след. стр

function seatClick(session, dbIndex) {
  const getData = `${
    `movieImg=${DATABASE[dbIndex].img};` +
    `movieLink=${DATABASE[dbIndex].link};` +
    `movieName=${encodeURI(DATABASE[dbIndex].movie)}`
  }`;
  const URL = 'Movie.html';
  const seats = document.getElementsByClassName('seat');
  const root = document.getElementById('tickets');
  const seatsArr = Array.from(seats);
  for (let eachSeat of seatsArr) {
    eachSeat.addEventListener('click', function clickID() {
      const curSeat = parseInt(this.id, 10);
      if (this.classList.contains('booked')) {
        alert(
          `Вы нажали на ${
            curSeat + 1
          } место и оно уже занято! Пожалуйста, выберите другое сидение.`
        );
      } else {
        const row = parseInt(curSeat / 10, 10);
        const seat = curSeat % 10;
        const allInf = `${getData};movieRow=${row + 1};movieSeat=${seat + 1}`;
        this.classList.toggle('booked');
        root.innerHTML = `Вы выбрали место под номер ${
          curSeat + 1
        }. <p>Ваше место в кинотеатре: <p>${row + 1} ряд ${
          seat + 1
        } место.</p> <p>Приятного просмотра!</p> <a href=${`${URL}?${allInf}`} target='_blank'class="shine-button">Перейдите на страницу просмотра</a>`;
      }
    });
  }
}

// функция вызывается после отрисовки зала, навешивается обработчик событий

// eslint-disable-next-line no-unused-vars
function sessionClick(event) {
  const indexes = event.id.split('-');
  const session = DATABASE[indexes[0]].session[indexes[1]];
  const sessionCount = session.seat;
  const root = document.getElementsByClassName('session-root');

  showSeat(sessionCount, root[indexes[0]]);
  showBooked(session);
  seatClick(session, indexes[0]);
}
