const DATABASE = [
{
movie: 'Неприкасаемые / 1+1',
detail: `Оригинальное название: Intouchables; Год: 2011; Страна: Франция; Продолжительность: 01:52:25; Жанр: Драмы, Комедии; Режиссер: Оливье Накаш, Эрик Толедано; В главных ролях: Франсуа Клюзе, Омар Си, Анн Ле Ни, Одри Флеро, Клотильд Молле, Альба Гайя Крагеде Беллуджи, Сирил Менди, Кристиан Амери, Грегуар Эстерманн, Жозефин де Мо`,
plot: '<p>В результате страшного несчастного случая Филипп, очень богатый и известный аристократ, лишился возможности ходить, и теперь навсегда прикован к инвалидному креслу. Он решает нанять себе помощника, который стал бы для него подмогой в непростых делах инвалида. Но выбор его весьма странен. Его спутником становится недавно вышедший из тюрьмы молодой человек. И он не ошибся. Не смотря на неподвижность Филиппа, парню удаётся вернуть того к жизни. Его бесшабашные авантюры и шутки оживляют аристократа и возвращают его в реальный мир.</p>',
img: 'https://avatars.mds.yandex.net/get-zen_doc/1328466/pub_5e8b4f673cbda1194d5d9397_5e8b5b223cbda1194d5d94b3/scale_1200',
link: 'https://www.youtube.com/embed/whTjYy464cY',
trailer: 'https://www.youtube.com/embed/aMEYTIt6xzU',
session: [{
		date: 15.04,
		seat: 90,
		reserved: [0, 15, 23, 34, 47],
		},
		{
		date: 16.04,
		seat: 60,
		reserved: [2, 9, 16, 27, 29],
		},
		{
		date: 16.04,
		seat: 70,
		reserved: [2, 9, 16, 27, 29],
		},
		{
		date: 16.04,
		seat: 70,
		reserved: [2, 9, 16, 27, 29],
		},
		{
		date: 17.04,
		seat: 100,
		reserved: [1, 7, 14, 20, 32],
	}]
},

{
movie: 'Мой маленький пони в кино',
detail: `Оригинальное название: My Little Pony: The Movie; Год: 2017; Страна: Канада, США; Продолжительность: 01:39:23; Жанр: Мультфильмы; Режиссер: Джейсон Тиссен; В главных ролях: Узо Адуба, Эшли Болл, Эмили Блант, Кристин Ченоуэт, Мишель Кребер, Тэй Диггз, Брайан Добсон, Майкл Добсон, Андреа Либман`,
plot: '<p>Жизнь в Эквистерии течет своим чередом, пока в небе не появляется таинственный дирижабль, на борту которого находится злобная пони-единорог Буря. Она является правой рукой зловещего Короля Шторма, захватившего земли к югу от Эквистерии. Не желая останавливаться на достигнутом, он решил прибрать к рукам и страну пони, лишив их магии. Буря с легкостью справилась с тремя могущественными принцессами и теперь ей осталось победить только Твайлайт Спаркл. Однако принцессе дружбы удалось сбежать вместе с верными друзьями, и теперь на их плечи ложится огромная ответственность за всю страну. Смогут ли они остановить злобного короля и спасти свой чудесный мир?..</p>',
img: 'https://mstrok.ru/assets/mstrok_files_2/images/afisha/2017/10/11/928612.jpg',
link: 'https://www.youtube.com/embed/tZvwQRRNFWM',
trailer: 'https://www.youtube.com/embed/uVORfWM1_9E',
session: [{
		date: 15.04,
		seat: 80,
		reserved: [0, 15, 23, 34, 47],
		},
		{
		date: 16.04,
		seat: 70,
		reserved: [2, 9, 16, 27, 29],
		},
		{
		date: 16.04,
		seat: 100,
		reserved: [2, 6, 10, 16, 27, 29, 34, 56, 57, 67, 72, 84, 91],
		},
		{
		date: 16.04,
		seat: 80,
		reserved: [0, 5, 19, 25, 67, 77],
		},
		{
		date: 17.04,
		seat: 100,
		reserved: [1, 7, 14, 20, 32],
	}]
},

{
movie: 'Артур и минипуты',
detail: `Оригинальное название: Arthur et les Minimoys; Год выхода: 2006; Страна: Франция; Продолжительность: 01:40:32; Жанр: Мультфильмы; Режиссер: Люк Бессон; В главных ролях: Фредди Хаймор, Миа Фэрроу, Рон Кроуфорд, Пенни Бальфур, Даг Рэнд, Адам ЛеФевр, Жан Бежот Нжамба, Сауль Джефкотт, Ли ДеЛонг, Кристиан Эриксон`,
plot: '<p>На долю десятилетнего Артура выпало непростое испытание: дом его бабушки хотят отнять за долги, и никто не поможет ему справиться с этой напастью. Быть может, ключ к решению проблемы кроется в сокровищах его дедушки, которые спрятаны где-то в стране минипутов, сказочных крохотных существ. В стране минипутов Артур знакомится с принцессой Селенией и её братом Барахлюшем. Их ждёт множество захватывающих приключений, опасностей и интриг на пути, который ведёт их в запретный город Некрополис. Там детской компании предстоит пережить недетский ужас в лице Ужасного Урдалака.</p>',
img: 'https://kinochannel.ru/wp-content/uploads/2017/06/b5285bf9fb5587939c1ca2bf6e59618c.jpg',
link: 'https://www.youtube.com/embed/pmA4xwoMb_Y',
trailer: 'https://www.youtube.com/embed/A7HVzD3vdh8',
session: [{
		date: 15.04,
		seat: 50,
		reserved: [0, 15, 23, 34, 47],
		},
		{
		date: 16.04,
		seat: 70,
		reserved: [2, 9, 16, 27, 29],
		},
		{
		date: 17.04,
		seat: 80,
		reserved: [1, 7, 14, 20, 32],
	}]
},

{
movie: 'Клуб Винкс: Тайна морской бездны',
detail: `Оригинальное название: Winx Club: Il Mistero degli Abissi; Год: 2014; Страна: Италия; Продолжительность: 01:22:39; Жанр: Мультфильмы; Режиссер: Иджинио Страффи; В главных ролях: Летиция Чиампа, Перла Либератори, Илария Латини, Джемма Донати, Домитилья Д’амико, Лаура Ленги, Марко Вивио, Алессандра Коромпай, Татьяна Десси, Федерика Де Бортоли`,
plot: '<p>Трикс вернулись! Они хотят завладеть Императорским Троном, чтобы активировать огромную силу, но случайно будят Политею — злую нимфу, до сих пор проклятую тремя Древними Ведьмами Прородительницами. Она готова заключить сделку с Трикс. Политея рассказывает им о том, что для активации Трона им нужно освободить Тританнуса из Обливиона, но до этого им нужно заполучить жизненную силу Короля. Трикс сразу подумали о Скае, который является королём Эраклиона и к тому же женихом Блум. Ведьмы отправляются в Гардению, где Блум и Скай проводят время вместе.<p>',
img: 'http://media.filmz.ru/photos/full/filmz.ru_f_197953.jpg',
link: 'https://www.youtube.com/embed/TPvcnrvav6c',
trailer: 'https://www.youtube.com/embed/ET0VNK2dii8',
session: [
		{
		date: 16.04,
		seat: 50,
		reserved: [2, 9, 16, 27, 29],
		},
		{
		date: 17.04,
		seat: 90,
		reserved: [1, 7, 14, 20, 32],
	}]
},

{
movie: 'Ла-Ла Ленд',
detail: `Оригинальное название: La La Land; Год: 2016; Страна: США; Продолжительность: 02:08:34; Жанр: Драмы, Комедии, Мелодрамы, Мюзиклы; Режиссер: Дэмьен Шазелл; В главных ролях: Райан Гослинг, Эмма Стоун, Джон Ледженд, Дж.К. Симмонс, Розмари ДеУитт, Финн Уиттрок, Калли Эрнандес, Соноя Мидзуно, Джессика Рот, Том Эверетт Скотт`,
plot: '<p>Миа — молодая девушка, проживающая в Лос-Анджелесе. Она работает официантом в одном из кафе и мечтает стать знаменитой актрисой. Девушка посещает множество кастингов, но ей пока не удалось получить долгожданную роль. Однажды она знакомится с молодым пианистом Себастьяном, который совсем недавно лишился работы. Парень мечтает открыть собственный джаз-клуб, в котором он будет исполнять любимые произведения, но пока ему приходится за гроши работать в ресторанах и барах. С первого взгляда между молодыми людьми вспыхивают чувства, которые дарят им веру в свои силы. Постепенно они начинают добиваться успеха, однако это не начинает влиять на их отношения, причем не в лучшую сторону...</p>',
img: 'https://www.stratege.ru/forums/files/gallery/1/5df/038/6c185c5a4b5ec98825adfcc71be8beaa.jpg',
link: 'https://www.youtube.com/embed/_NIv5QT-vb0',
trailer: 'https://www.youtube.com/embed/hWrRLnn6McI',
session: [{
		date: 15.04,
		seat: 60,
		reserved: [0, 15, 23, 34, 47],
		},
		{
		date: 16.04,
		seat: 70,
		reserved: [2, 9, 16, 27, 29],
		},
		{
		date: 17.04,
		seat: 50,
		reserved: [1, 7, 14, 20, 32],
	}]
},
];



function showBooked(places) {
	const seats = document.getElementsByClassName("seat");
	let reserved = places.reserved;
	let arrSeat = Array.from(seats);

	arrSeat.forEach((current, index) => {
	for (let i = 0; i < reserved.length; i++) {
		if (index === reserved[i]) current.classList.toggle("booked");
		}
	});

};


function sessionClick(event) {
	let indexes = event.id.split("-");
	console.log(indexes);
	let session = DATABASE[indexes[0]].session[indexes[1]];
	let sessionCount = session.seat;
	const root = document.getElementsByClassName("session-root");

	showSeat(sessionCount, root[indexes[0]]);
	showBooked(session);
	seatClick(session, indexes[0]);
};


function showSeat (session, root) {
	let forArr = ``;
	for (let i = 0; i < session; i++) {
	forArr += `<div class="seat" id=${i}> </div>`;
	}
	let cinemahall = `
	<div class="mw-session">
		<div id="tickets">Вы ещё не выбрали место</div>
	<div id="cinemahall"> 
		${forArr}
		</div>
	</div>
	`;
	root.innerHTML = cinemahall;
}



function seatClick(session, dbIndex) {
	let getData = `${'movieImg='+DATABASE[dbIndex].img + ';' + 'movieLink=' + DATABASE[dbIndex].link + ';' + 'movieName=' + encodeURI(DATABASE[dbIndex].movie)}`
	const URL = 'Movie.html';
	const seats = document.getElementsByClassName("seat");
	let root = document.getElementById("tickets");
	const seatsArr = Array.from(seats);
	let show = seatsArr.forEach((eachSeat, idex) => 
		eachSeat.addEventListener('click', function clickID () {
			const curSeat = parseInt(this.id);
			if (this.classList.contains('booked')) {
				alert(`Вы нажали на ${curSeat+1} место и оно уже занято! Пожалуйста, выберите другое сидение.`)
			}
			else {
				let row = parseInt(curSeat/10);
				let seat = curSeat%10;

				let allInf = `${getData+';'+'movieRow='+(row+1)+';'+'movieSeat='+(seat+1)}`;
				this.classList.toggle("booked");
				root.innerHTML = `Вы выбрали место под номер ${curSeat+1}. <p>Ваше место в кинотеатре: <p>${row+1} ряд ${seat+1} место.</p> <p>Приятного просмотра!</p> <a href=${URL+'?'+allInf} target='_blank'class="shine-button">Перейдите на страницу просмотра</a>`
			}
		  } )
		);
}


function loader() {
	const heading = Array.from(document.getElementsByClassName("el__heading"));
	const bg = Array.from(document.getElementsByClassName("el__bg"));
	const inf = Array.from(document.getElementsByClassName("el__details"));
	const name = Array.from(document.getElementsByClassName("el__text"));
	const treilers = Array.from(document.getElementsByClassName("el__player"));
	let temp = '';
	let tempDet = '';

	for (let i = 0; i < DATABASE.length; i += 1) {

		heading[i].innerHTML = '⚝ '+DATABASE[i].movie+' ⚝';
		// заголовки секций, название фильма

		temp = DATABASE[i].img;
		bg[i].style.backgroundImage = `url(${temp})`;
		bg[i].style.backgroundRepeat = "no-repeat";
		bg[i].style.backgroundPosition = "left"; 
		bg[i].style.backgroundSize = 'contain';
		bg[i].style.backgroundAttachment = 'fixed';
		// фоновые постеры для секций

		let par = DATABASE[i].detail.split(";");
		tempDet = '';
		for(let j = 0; j < par.length; j += 1) {
			tempDet += `<p>${par[j]}</p> `
		}

		inf[i].innerHTML = tempDet;
		// детали фильма в каждую секцию

		name[i].innerHTML = DATABASE[i].movie;
		// название фильма (левая часть)

		treilers[i].src = DATABASE[i].trailer;
		// проигрыватель для трейлера
	}
}

loader();


function renderSeans() {
	let seansRoot = Array.from(document.getElementsByClassName("el__seans"));
	let session = null;

	seansRoot.forEach(function (current, index) {
	session = DATABASE[index].session;
	let links = ``; 

	for (let i = 0; i < session.length; i++) {
		links += `<span class="el__sesion__link" id=${index+"-"+i} onclick="sessionClick(this)"> Сеанс ${session[i].date}  </span> <br>`
	};

	let div = document.createElement('div');
	div.className = "session-root";
	div.id = index;

	current.innerHTML = links;
	current.append(div);

	});
};

renderSeans();